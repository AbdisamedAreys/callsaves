<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Resellers Dashboard + Push</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1, h2 { color: #2196F3; }
    .dashboard { margin-bottom: 20px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 30px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #2196F3; color: white; }
    tr:nth-child(even) { background-color: #f2f2f2; }
    .true-row { background-color: #d4edda; }
    .false-row { background-color: #f8d7da; }
    button.copy-btn { margin-left: 5px; padding: 2px 5px; font-size: 0.9em; }
    button.register-btn { padding: 5px 10px; background-color: #2196F3; color: white; border: none; cursor: pointer; border-radius: 3px; }
    button.register-btn:hover { background-color: #1976D2; }
  </style>
</head>
<body>
<h1>Resellers Sheet Dashboard</h1>
<div class="dashboard">
  <p>Number of TRUE rows: <span id="trueCount">0</span></p>
  <p>Number of FALSE rows: <span id="falseCount">0</span></p>
</div>

<h2>TRUE Table</h2>
<table id="trueTable">
  <thead>
    <tr><th>Name</th><th>Phone number</th><th>Internet number</th><th>Operator</th></tr>
  </thead>
  <tbody><tr><td colspan="4">Loading...</td></tr></tbody>
</table>

<h2>FALSE Table</h2>
<table id="falseTable">
  <thead>
    <tr><th>Name</th><th>Phone number</th><th>Internet number</th><th>Operator</th><th>Action</th></tr>
  </thead>
  <tbody><tr><td colspan="5">Loading...</td></tr></tbody>
</table>

<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbz9RyY--TiCHrkK2VkE2OLwsvoqkiIPg4J5EtyhZUU0fdj46V3JgiUA0Jp9DAp2N0YEcA/exec";

let lastFalseCount = 0;

// Fetch and render tables
function loadData() {
  fetch(SHEET_URL)
    .then(res => res.json())
    .then(data => {
      if (data && Array.isArray(data)) {
        renderTables(data);
      } else {
        console.error("Invalid data:", data);
      }
    })
    .catch(err => console.error("Fetch error:", err));
}

// Render tables
function renderTables(data) {
  const trueTableBody = document.querySelector("#trueTable tbody");
  const falseTableBody = document.querySelector("#falseTable tbody");
  let trueRows = 0, falseRows = 0;

  trueTableBody.innerHTML = "";
  falseTableBody.innerHTML = "";

  data.forEach((row, index) => {
    const status = row[row.length - 1];
    const displayRow = row.slice(0, row.length - 1);

    if (status === true || status === "TRUE") {
      const tr = document.createElement("tr");
      displayRow.forEach(cell => {
        const td = document.createElement("td");
        td.textContent = cell;
        tr.appendChild(td);
      });
      tr.classList.add("true-row");
      trueTableBody.appendChild(tr);
      trueRows++;
    } else {
      const tr = document.createElement("tr");

      displayRow.forEach((cell, colIndex) => {
        const td = document.createElement("td");
        td.textContent = cell;

        // Add copy buttons for Phone number and Internet number
        if (colIndex === 1 || colIndex === 2) {
          const copyBtn = document.createElement("button");
          copyBtn.textContent = "Copy";
          copyBtn.className = "copy-btn";
          copyBtn.addEventListener("click", () => {
            navigator.clipboard.writeText(cell).then(() => alert("Copied: " + cell));
          });
          td.appendChild(copyBtn);
        }
        tr.appendChild(td);
      });

      // Action button
      const actionTd = document.createElement("td");
      const registerBtn = document.createElement("button");
      registerBtn.textContent = "Register";
      registerBtn.className = "register-btn";
      registerBtn.addEventListener("click", () => {
        if (confirm(`Are you sure you want to register ${displayRow[0]}?`)) {
          // Call Apps Script to update status in Google Sheet
          fetch(SHEET_URL + "?action=register&row=" + (index + 2)) // +2 to skip header
            .then(res => res.json())
            .then(() => {
              alert(displayRow[0] + " is now registered!");
              loadData(); // refresh the table
            })
            .catch(err => console.error(err));
        }
      });
      actionTd.appendChild(registerBtn);
      tr.appendChild(actionTd);

      tr.classList.add("false-row");
      falseTableBody.appendChild(tr);
      falseRows++;
    }
  });

  document.getElementById("trueCount").textContent = trueRows;
  document.getElementById("falseCount").textContent = falseRows;

  if (trueRows === 0) trueTableBody.innerHTML = '<tr><td colspan="4">No TRUE rows</td></tr>';
  if (falseRows === 0) falseTableBody.innerHTML = '<tr><td colspan="5">Ma jiro qof cusub oo ku sugaya </td></tr>';

  // Push notification for new FALSE rows
  if (falseRows > lastFalseCount) notifyFalseRows(falseRows);
  lastFalseCount = falseRows;
}

function notifyFalseRows(count) {
  if (!("Notification" in window)) return;
  if (Notification.permission === "granted") {
    new Notification(`${count} is ready to register`, {
      body: `${count} are waiting for you, please register as possible`,
      requireInteraction: true,
      silent: false
    });
  }
}

// Ask permission for notifications
if ("Notification" in window && Notification.permission !== "granted") {
  Notification.requestPermission();
}

// Initial load
loadData();
// Auto refresh every 30 seconds
setInterval(loadData, 30000);
</script>
</body>
</html>





